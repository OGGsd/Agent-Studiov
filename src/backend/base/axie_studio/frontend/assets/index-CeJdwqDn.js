import{U as X,a as Z,g as J,r as i,C as ce,A as re,j as e,B as L,F as E,$ as oe,b as R,c as D,d as $,e as O,E as K,f as Q,h as Y,i as B,k as de,P as ee,l as se,u as te,m as ue,n as me,o as xe,I as he,p as pe,S as V,q as h,s as ae,t as fe,v as je,w as ge,x as ve,y as W,z as q,D as ne}from"./index-DUNtuzu6.js";import{T as Ne,a as Ce,b as ie,c as C,d as Se,e as S}from"./table-D7EXerYW.js";const we=o=>{const{mutate:d}=X();return d(["useDeleteUsers"],async({user_id:u})=>(await Z.delete(`${J("USERS")}/${u}`)).data,o)},Ee=o=>{const{mutate:d}=X();async function m({skip:u,limit:p}){const a=await Z.get(`${J("USERS")}/?skip=${u}&limit=${p}`);return a.status===200?a.data:[]}return d(["useGetUsers"],m,o)},Ue=o=>{const{mutate:d}=X();return d(["useAddUser"],async u=>(await Z.post(`${J("USERS")}/`,u)).data,o)};function _e({title:o,titleHeader:d,cancelText:m,confirmationText:v,children:u,icon:p,data:a,index:U,onConfirm:M,asChild:F}){const[f,k]=i.useState(!1),[x,H]=i.useState(!1),[l,_]=i.useState(!1),[c,b]=i.useState((a==null?void 0:a.password)??""),[N,w]=i.useState((a==null?void 0:a.username)??""),[j,P]=i.useState((a==null?void 0:a.password)??""),[g,y]=i.useState((a==null?void 0:a.is_active)??!1),[T,A]=i.useState((a==null?void 0:a.is_superuser)??!1),[z,G]=i.useState(ce),{userData:s}=i.useContext(re);function n({target:{name:t,value:I}}){G(le=>({...le,[t]:I}))}i.useEffect(()=>{l&&(a?(w(a.username),y(a.is_active),A(a.is_superuser),n({target:{name:"username",value:N}}),n({target:{name:"is_active",value:g}}),n({target:{name:"is_superuser",value:T}})):r())},[l]);function r(){b(""),w(""),P(""),y(!1),A(!1)}return e.jsxs(L,{size:"medium-h-full",open:l,setOpen:_,children:[e.jsx(L.Trigger,{asChild:F,children:u}),e.jsxs(L.Header,{description:d,children:[e.jsx("span",{className:"pr-2",children:o}),e.jsx(E,{name:p,className:"h-6 w-6 pl-1 text-foreground","aria-hidden":"true"})]}),e.jsx(L.Content,{children:e.jsxs(oe,{onSubmit:t=>{if(c!==j){t.preventDefault();return}r(),M(1,z),_(!1),t.preventDefault()},children:[e.jsxs("div",{className:"grid gap-5",children:[e.jsxs(R,{name:"username",children:[e.jsx("div",{style:{display:"flex",alignItems:"baseline",justifyContent:"space-between"},children:e.jsxs(D,{className:"data-[invalid]:label-invalid",children:["Username"," ",e.jsx("span",{className:"font-medium text-destructive",children:"*"})]})}),e.jsx($,{asChild:!0,children:e.jsx("input",{onChange:({target:{value:t}})=>{n({target:{name:"username",value:t}}),w(t)},value:N,className:"primary-input",required:!0,placeholder:"Username"})}),e.jsx(O,{match:"valueMissing",className:"field-invalid",children:"Please enter your username"})]}),e.jsxs("div",{className:"flex flex-row",children:[e.jsx("div",{className:"mr-3 basis-1/2",children:e.jsxs(R,{name:"password",serverInvalid:c!=j,children:[e.jsx("div",{style:{display:"flex",alignItems:"baseline",justifyContent:"space-between"},children:e.jsxs(D,{className:"data-[invalid]:label-invalid flex",children:["Password"," ",e.jsx("span",{className:"ml-1 mr-1 font-medium text-destructive",children:"*"}),f&&e.jsx(K,{onClick:()=>k(!f),className:"h-5 cursor-pointer",strokeWidth:1.5}),!f&&e.jsx(Q,{onClick:()=>k(!f),className:"h-5 cursor-pointer",strokeWidth:1.5})]})}),e.jsx($,{asChild:!0,children:e.jsx("input",{onChange:({target:{value:t}})=>{n({target:{name:"password",value:t}}),b(t)},value:c,className:"primary-input",required:!a,type:f?"text":"password"})}),e.jsx(O,{className:"field-invalid",match:"valueMissing",children:"Please enter a password"}),c!=j&&e.jsx(O,{className:"field-invalid",children:"Passwords do not match"})]})}),e.jsx("div",{className:"basis-1/2",children:e.jsxs(R,{name:"confirmpassword",serverInvalid:c!=j,children:[e.jsx("div",{style:{display:"flex",alignItems:"baseline",justifyContent:"space-between"},children:e.jsxs(D,{className:"data-[invalid]:label-invalid flex",children:["Confirm password"," ",e.jsx("span",{className:"ml-1 mr-1 font-medium text-destructive",children:"*"}),x&&e.jsx(K,{onClick:()=>H(!x),className:"h-5 cursor-pointer",strokeWidth:1.5}),!x&&e.jsx(Q,{onClick:()=>H(!x),className:"h-5 cursor-pointer",strokeWidth:1.5})]})}),e.jsx($,{asChild:!0,children:e.jsx("input",{onChange:t=>{P(t.target.value)},value:j,className:"primary-input",required:!a,type:x?"text":"password"})}),e.jsx(O,{className:"field-invalid",match:"valueMissing",children:"Please confirm your password"})]})})]}),e.jsxs("div",{className:"flex gap-8",children:[e.jsx(R,{name:"is_active",children:e.jsxs("div",{children:[e.jsx(D,{className:"data-[invalid]:label-invalid mr-3",children:"Active"}),e.jsx($,{asChild:!0,children:e.jsx(Y,{value:g,checked:g,id:"is_active",className:"relative top-0.5",onCheckedChange:t=>{n({target:{name:"is_active",value:t}}),y(t)}})})]})}),(s==null?void 0:s.is_superuser)&&e.jsx(R,{name:"is_superuser",children:e.jsxs("div",{children:[e.jsx(D,{className:"data-[invalid]:label-invalid mr-3",children:"Superuser"}),e.jsx($,{asChild:!0,children:e.jsx(Y,{checked:T,value:T,id:"is_superuser",className:"relative top-0.5",onCheckedChange:t=>{n({target:{name:"is_superuser",value:t}}),A(t)}})})]})})]})]}),e.jsxs("div",{className:"float-right",children:[e.jsx(B,{variant:"outline",onClick:()=>{_(!1)},className:"mr-3",children:m}),e.jsx(de,{asChild:!0,children:e.jsx(B,{className:"mt-8",children:v})})]})]})})]})}function Te(){const[o,d]=i.useState(""),[m,v]=i.useState(ee),[u,p]=i.useState(se),a=te(s=>s.setSuccessData),U=te(s=>s.setErrorData),{userData:M}=i.useContext(re),[F,f]=i.useState(0),{mutate:k}=we(),{mutate:x}=ue(),{mutate:H}=Ue(),l=i.useRef([]);i.useEffect(()=>{setTimeout(()=>{j()},500)},[]);const[_,c]=i.useState(l.current),{mutate:b,isPending:N,isIdle:w}=Ee({});function j(){b({skip:m*(u-1),limit:m},{onSuccess:s=>{f(s.total_count),l.current=s.users,c(s.users)},onError:()=>{}})}function P(s,n){v(n),p(s),b({skip:n*(s-1),limit:n},{onSuccess:r=>{f(r.total_count),l.current=r.users,c(r.users)}})}function g(){p(se),v(ee),j()}function y(s){if(d(s),s==="")c(l.current);else{const n=l.current.filter(r=>r.username.toLowerCase().includes(s.toLowerCase()));c(n)}}function T(s){k({user_id:s.id},{onSuccess:()=>{g(),a({title:ve})},onError:n=>{U({title:ge,list:[n.response.data.detail]})}})}function A(s,n){x({user_id:s,user:n},{onSuccess:()=>{g(),a({title:q})},onError:r=>{U({title:W,list:[r.response.data.detail]})}})}function z(s,n,r){const t=ne.cloneDeep(r);t.is_active=!s,x({user_id:n,user:t},{onSuccess:()=>{g(),a({title:q})},onError:I=>{U({title:W,list:[I.response.data.detail]})}})}function G(s,n,r){const t=ne.cloneDeep(r);t.is_superuser=!s,x({user_id:n,user:t},{onSuccess:()=>{g(),a({title:q})},onError:I=>{U({title:W,list:[I.response.data.detail]})}})}return e.jsx(e.Fragment,{children:M&&e.jsxs("div",{className:"admin-page-panel flex h-full flex-col pb-8",children:[e.jsx("div",{className:"main-page-nav-arrangement",children:e.jsxs("span",{className:"main-page-nav-title",children:[e.jsx(E,{name:"Shield",className:"w-6"}),me]})}),e.jsx("span",{className:"admin-page-description-text",children:xe}),e.jsxs("div",{className:"flex w-full justify-between px-4",children:[e.jsxs("div",{className:"flex w-96 items-center gap-4",children:[e.jsx(he,{placeholder:"Search Username",value:o,onChange:s=>y(s.target.value)}),o.length>0?e.jsx("div",{className:"cursor-pointer",onClick:()=>{d(""),c(l.current)},children:e.jsx(E,{name:"X",className:"w-6 text-foreground"})}):e.jsx("div",{children:e.jsx(E,{name:"Search",className:"w-6 text-foreground"})})]}),e.jsx("div",{children:e.jsx(B,{variant:"primary",onClick:()=>window.location.href="/admin/accounts",children:"Manage Accounts"})})]}),N||w?e.jsx("div",{className:"flex h-full w-full items-center justify-center",children:e.jsx(pe,{remSize:12})}):l.current.length===0&&!w?e.jsx(e.Fragment,{children:e.jsx("div",{className:"m-4 flex items-center justify-between text-sm",children:"No users registered."})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"m-4 h-fit overflow-x-hidden overflow-y-scroll rounded-md border-2 bg-background custom-scroll"+(N?" border-0":""),children:e.jsxs(Ne,{className:"table-fixed outline-1",children:[e.jsx(Ce,{className:N?"hidden":"table-fixed bg-muted outline-1",children:e.jsxs(ie,{children:[e.jsx(C,{className:"h-10",children:"Id"}),e.jsx(C,{className:"h-10",children:"Username"}),e.jsx(C,{className:"h-10",children:"Active"}),e.jsx(C,{className:"h-10",children:"Superuser"}),e.jsx(C,{className:"h-10",children:"Created At"}),e.jsx(C,{className:"h-10",children:"Updated At"}),e.jsx(C,{className:"h-10 w-[100px] text-right"})]})}),!N&&e.jsx(Se,{children:_.map((s,n)=>e.jsxs(ie,{children:[e.jsx(S,{className:"truncate py-2 font-medium",children:e.jsx(V,{content:s.id,children:e.jsx("span",{className:"cursor-default",children:s.id})})}),e.jsx(S,{className:"truncate py-2",children:e.jsx(V,{content:s.username,children:e.jsx("span",{className:"cursor-default",children:s.username})})}),e.jsx(S,{className:"relative left-1 truncate py-2 text-align-last-left",children:e.jsxs(h,{size:"x-small",title:"Edit",titleHeader:`${s.username}`,modalContentTitle:"Attention!",cancelText:"Cancel",confirmationText:"Confirm",icon:"UserCog2",data:s,index:n,onConfirm:(r,t)=>{z(t.is_active,t.id,t)},children:[e.jsx(h.Content,{children:e.jsx("span",{children:"Are you completely confident about the changes you are making to this user?"})}),e.jsx(h.Trigger,{children:e.jsx("div",{className:"flex w-fit",children:e.jsx(ae,{checked:s.is_active})})})]})}),e.jsx(S,{className:"relative left-1 truncate py-2 text-align-last-left",children:e.jsxs(h,{size:"x-small",title:"Edit",titleHeader:`${s.username}`,modalContentTitle:"Attention!",cancelText:"Cancel",confirmationText:"Confirm",icon:"UserCog2",data:s,index:n,onConfirm:(r,t)=>{G(t.is_superuser,t.id,t)},children:[e.jsx(h.Content,{children:e.jsx("span",{children:"Are you completely confident about the changes you are making to this user?"})}),e.jsx(h.Trigger,{children:e.jsx("div",{className:"flex w-fit",children:e.jsx(ae,{checked:s.is_superuser})})})]})}),e.jsx(S,{className:"truncate py-2",children:new Date(s.create_at).toISOString().split("T")[0]}),e.jsx(S,{className:"truncate py-2",children:new Date(s.updated_at).toISOString().split("T")[0]}),e.jsx(S,{className:"flex w-[100px] py-2 text-right",children:e.jsxs("div",{className:"flex",children:[e.jsx(_e,{title:"Edit",titleHeader:`${s.id}`,cancelText:"Cancel",confirmationText:"Save",icon:"UserPlus2",data:s,index:n,onConfirm:(r,t)=>{A(s.id,t)},children:e.jsx(V,{content:"Edit",side:"top",children:e.jsx(E,{name:"Pencil",className:"h-4 w-4 cursor-pointer"})})}),e.jsxs(h,{size:"x-small",title:"Delete",titleHeader:"Delete User",modalContentTitle:"Attention!",cancelText:"Cancel",confirmationText:"Delete",icon:"UserMinus2",data:s,index:n,onConfirm:(r,t)=>{T(t)},children:[e.jsx(h.Content,{children:e.jsx("span",{children:"Are you sure you want to delete this user? This action cannot be undone."})}),e.jsx(h.Trigger,{children:e.jsx(E,{name:"Trash2",className:"ml-2 h-4 w-4 cursor-pointer"})})]})]})})]},n))})]})}),e.jsx(fe,{pageIndex:u,pageSize:m,totalRowsCount:F,paginate:P,rowsCount:je})]})]})})}export{Te as default};
